'use strict';Object.defineProperty(exports,'__esModule',{value:true});var eventemitter3=require('eventemitter3');var oe=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var ve=Object.prototype.hasOwnProperty;var T=(n,e)=>()=>(n&&(e=n(n=0)),e);var v=(n,e)=>{for(var t in e)oe(n,t,{get:e[t],enumerable:true});},we=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Pe(e))!ve.call(n,i)&&i!==t&&oe(n,i,{get:()=>e[i],enumerable:!(r=Ae(e,i))||r.enumerable});return n};var w=n=>we(oe({},"__esModule",{value:true}),n);function Oe(){return `req_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}function F(n,e,t){let r=Se(n.data)||n.statusText;switch(n.status){case 401:return new exports.AuthenticationError(r,e,{statusCode:n.status,...t!==void 0&&{requestId:t}});case 403:return new exports.AuthorizationError(r,e,{statusCode:n.status,...t!==void 0&&{requestId:t}});case 404:let i=De(n.data),s=xe(n.data);return i&&s?new exports.NotFoundError(i,s,e,{...t!==void 0&&{requestId:t}}):new exports.NotFoundError("Resource","unknown",e,{...t!==void 0&&{requestId:t}});case 422:let a=Me(n.data);return new exports.ValidationError(r,e,a,{...t!==void 0&&{requestId:t}});case 429:let o=qe(n.data);return new exports.RateLimitError(r,e,{...o!==void 0&&{retryAfter:o},...t!==void 0&&{requestId:t}});case 500:case 502:case 503:case 504:return new exports.NetworkError(r,e,{statusCode:n.status,...t!==void 0&&{requestId:t},retryable:true});default:return new exports.NetworkError(r,e,{statusCode:n.status,...t!==void 0&&{requestId:t},retryable:n.status>=500})}}function Se(n){if(typeof n=="object"&&n!==null){let e=n;return e.message||e.detail||null}return null}function De(n){return typeof n=="object"&&n!==null&&n.resourceType||null}function xe(n){return typeof n=="object"&&n!==null&&n.resourceId||null}function Me(n){if(typeof n=="object"&&n!==null){let e=n;if(Array.isArray(e.violations))return e.violations.map(t=>({field:t.propertyPath||t.field||"unknown",message:t.message||"Validation failed",code:t.code||"VALIDATION_FAILED",value:t.value}));if(Array.isArray(e.detail))return e.detail.map(t=>({field:t.loc?.join(".")||"unknown",message:t.msg||"Validation failed",code:t.type||"VALIDATION_FAILED",value:t.input}))}return []}function qe(n){if(typeof n=="object"&&n!==null){let e=n,t=e.retryAfter||e.retry_after;return typeof t=="number"?t:void 0}}exports.ACubeSDKError=void 0;exports.NetworkError=void 0;exports.AuthenticationError=void 0;exports.AuthorizationError=void 0;exports.ValidationError=void 0;exports.FiscalError=void 0;exports.RateLimitError=void 0;exports.ConfigurationError=void 0;exports.NotFoundError=void 0;exports.CircuitBreakerError=void 0;var R=T(()=>{exports.ACubeSDKError=class extends Error{constructor(t,r,i){super(t);this.code=r;i.cause&&(this.cause=i.cause),this.name=this.constructor.name,this.timestamp=new Date,this.requestId=i.requestId??Oe(),this.operation=i.operation,this.retryable=i.retryable??false,i.statusCode!==void 0&&(this.statusCode=i.statusCode),i.auditInfo!==void 0&&(this.auditInfo=i.auditInfo),Object.setPrototypeOf(this,new.target.prototype);}toJSON(){return {name:this.name,message:this.message,code:this.code,operation:this.operation,retryable:this.retryable,statusCode:this.statusCode,timestamp:this.timestamp.toISOString(),requestId:this.requestId,auditInfo:this.auditInfo,stack:this.stack}}},exports.NetworkError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"NETWORK_ERROR",{operation:t,retryable:r.retryable??true,...r.statusCode!==void 0&&{statusCode:r.statusCode},...r.requestId!==void 0&&{requestId:r.requestId},...r.cause!==void 0&&{cause:r.cause}});}},exports.AuthenticationError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"AUTHENTICATION_ERROR",{operation:t,retryable:false,statusCode:r.statusCode??401,...r.requestId!==void 0&&{requestId:r.requestId},...r.auditInfo!==void 0&&{auditInfo:r.auditInfo}});}},exports.AuthorizationError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"AUTHORIZATION_ERROR",{operation:t,retryable:false,statusCode:r.statusCode??403,...r.requestId!==void 0&&{requestId:r.requestId},...r.auditInfo!==void 0&&{auditInfo:r.auditInfo}});}},exports.ValidationError=class extends exports.ACubeSDKError{constructor(e,t,r,i={}){super(e,"VALIDATION_ERROR",{operation:t,retryable:false,statusCode:422,...i.requestId!==void 0&&{requestId:i.requestId},...i.auditInfo!==void 0&&{auditInfo:i.auditInfo}}),this.violations=r;}toJSON(){return {...super.toJSON(),violations:this.violations}}},exports.FiscalError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"FISCAL_ERROR",{operation:t,retryable:r.retryable??false,statusCode:r.statusCode??400,...r.requestId!==void 0&&{requestId:r.requestId},...r.auditInfo!==void 0&&{auditInfo:r.auditInfo}}),r.fiscalCode!==void 0&&(this.fiscalCode=r.fiscalCode),r.documentNumber!==void 0&&(this.documentNumber=r.documentNumber);}toJSON(){return {...super.toJSON(),fiscalCode:this.fiscalCode,documentNumber:this.documentNumber}}},exports.RateLimitError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"RATE_LIMIT_ERROR",{operation:t,retryable:true,statusCode:429,...r.requestId!==void 0&&{requestId:r.requestId}}),r.retryAfter!==void 0&&(this.retryAfter=r.retryAfter);}toJSON(){return {...super.toJSON(),retryAfter:this.retryAfter}}},exports.ConfigurationError=class extends exports.ACubeSDKError{constructor(e,t,r={}){super(e,"CONFIGURATION_ERROR",{operation:t,retryable:false,...r.requestId!==void 0&&{requestId:r.requestId}});}},exports.NotFoundError=class extends exports.ACubeSDKError{constructor(e,t,r,i={}){super(`${e} with id ${t} not found`,"NOT_FOUND_ERROR",{operation:r,retryable:false,statusCode:404,...i.requestId!==void 0&&{requestId:i.requestId},...i.auditInfo!==void 0&&{auditInfo:i.auditInfo}}),this.resourceType=e,this.resourceId=t;}toJSON(){return {...super.toJSON(),resourceType:this.resourceType,resourceId:this.resourceId}}},exports.CircuitBreakerError=class extends exports.ACubeSDKError{constructor(e,t,r,i={}){super(e,"CIRCUIT_BREAKER_ERROR",{operation:t,retryable:true,...i.requestId!==void 0&&{requestId:i.requestId}}),this.state=r;}toJSON(){return {...super.toJSON(),state:this.state}}};});exports.CashierEndpoints=void 0;exports.PointOfSalesEndpoints=void 0;exports.ReceiptEndpoints=void 0;exports.CashRegisterEndpoints=void 0;exports.MerchantEndpoints=void 0;exports.PEMEndpoints=void 0;var O,E=T(()=>{exports.CashierEndpoints=class{};exports.CashierEndpoints.LIST={path:"/mf1/cashiers",method:"GET",operationId:"read_cashiers_mf1_cashiers_get",summary:"Read Cashiers",description:"Get a paginated list of cashiers",tags:["Cashier"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{query:{page:"integer",size:"integer"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_Page__T_Customized_CashierOutput_"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"cashiers",operation:"list",authRequired:true,retryable:true}},exports.CashierEndpoints.CREATE={path:"/mf1/cashiers",method:"POST",operationId:"create_cashier_mf1_cashiers_post",summary:"Create Cashier",description:"Create a new cashier account",tags:["Cashier"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_CashierCreateInput"},responses:{201:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CashierOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"cashiers",operation:"create",authRequired:true,retryable:false}},exports.CashierEndpoints.ME={path:"/mf1/cashiers/me",method:"GET",operationId:"read_cashier_me_mf1_cashiers_me_get",summary:"Read Cashier Me",description:"Read currently authenticated cashier's information",tags:["Cashier"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CashierOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"cashiers",operation:"me",authRequired:true,retryable:true}},exports.CashierEndpoints.GET_BY_ID={path:"/mf1/cashiers/{cashier_id}",method:"GET",operationId:"read_cashier_by_id_mf1_cashiers__cashier_id__get",summary:"Read Cashier By Id",description:"Get a specific user by id",tags:["Cashier"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{cashier_id:"integer"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CashierOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"cashiers",operation:"get",authRequired:true,retryable:true}},exports.CashierEndpoints.DELETE={path:"/mf1/cashiers/{cashier_id}",method:"DELETE",operationId:"delete_cashier_mf1_cashiers__cashier_id__delete",summary:"Delete Cashier",description:"Delete a cashier",tags:["Cashier"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{cashier_id:"integer"}},responses:{204:{description:"Successful Response"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"cashiers",operation:"delete",authRequired:true,retryable:false}};exports.PointOfSalesEndpoints=class{};exports.PointOfSalesEndpoints.LIST={path:"/mf1/point-of-sales",method:"GET",operationId:"read_point_of_sales_mf1_point_of_sales_get",summary:"Read Point Of Sales",description:"Retrieve PEMs",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_Page__T_Customized_PointOfSaleOutput_"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"point-of-sales",operation:"list",authRequired:true,retryable:true}},exports.PointOfSalesEndpoints.GET_BY_SERIAL={path:"/mf1/point-of-sales/{serial_number}",method:"GET",operationId:"read_point_of_sale_mf1_point_of_sales__serial_number__get",summary:"Read Point Of Sale",description:"Get a specific Point of Sale by serial number",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{serial_number:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_PointOfSaleOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"point-of-sales",operation:"get",authRequired:true,retryable:true}},exports.PointOfSalesEndpoints.CLOSE_JOURNAL={path:"/mf1/point-of-sales/close",method:"POST",operationId:"close_journal_mf1_point_of_sales_close_post",summary:"Close Journal",description:"Close the daily journal for Point of Sales",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_CloseJournalRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CloseJournalOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"point-of-sales",operation:"close_journal",authRequired:true,retryable:false}},exports.PointOfSalesEndpoints.ACTIVATION={path:"/mf1/point-of-sales/{serial_number}/activation",method:"POST",operationId:"post_activation_mf1_point_of_sales__serial_number__activation_post",summary:"Post Activation",description:"Trigger the activation process of a Point of Sale by requesting a certificate to the Italian Tax Agency",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{serial_number:"string"}},requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_ActivationRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_ActivationOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"point-of-sales",operation:"activation",authRequired:true,retryable:false}},exports.PointOfSalesEndpoints.CREATE_INACTIVITY={path:"/mf1/point-of-sales/{serial_number}/inactivity",method:"POST",operationId:"create_inactivity_period_mf1_point_of_sales__serial_number__inactivity_post",summary:"Create Inactivity Period",description:"Create a new inactivity period",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{serial_number:"string"}},requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_InactivityRequest"},responses:{200:{description:"Successful Response",contentType:"application/json"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"point-of-sales",operation:"create_inactivity",authRequired:true,retryable:false}},exports.PointOfSalesEndpoints.SET_OFFLINE={path:"/mf1/point-of-sales/{serial_number}/status/offline",method:"POST",operationId:"post_offline_mf1_point_of_sales__serial_number__status_offline_post",summary:"Post Offline",description:"Change the state of the Point of Sale to 'offline'",tags:["Point of Sale"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{serial_number:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"point-of-sales",operation:"set_offline",authRequired:true,retryable:false}};exports.ReceiptEndpoints=class{};exports.ReceiptEndpoints.LIST={path:"/mf1/receipts",method:"GET",operationId:"get_receipts_mf1_receipts_get",summary:"Get Receipts",description:"Get a list of electronic receipts",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{query:{page:"integer",size:"integer",start_date:"string",end_date:"string",serial_number:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_Page__T_Customized_ReceiptOutput_"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"receipts",operation:"list",authRequired:true,retryable:true}},exports.ReceiptEndpoints.CREATE={path:"/mf1/receipts",method:"POST",operationId:"create_receipt_mf1_receipts_post",summary:"Create Receipt",description:"Create a new electronic receipt",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_ReceiptInput"},responses:{201:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_ReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"receipts",operation:"create",authRequired:true,retryable:false}},exports.ReceiptEndpoints.VOID={path:"/mf1/receipts",method:"DELETE",operationId:"void_receipt_mf1_receipts_delete",summary:"Void Receipt",description:"Void an electronic receipt",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_VoidReceiptRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_VoidReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"receipts",operation:"void",authRequired:true,retryable:false}},exports.ReceiptEndpoints.GET_BY_UUID={path:"/mf1/receipts/{receipt_uuid}",method:"GET",operationId:"get_receipt_mf1_receipts__receipt_uuid__get",summary:"Get Receipt",description:"Get an electronic receipt",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{receipt_uuid:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_ReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"receipts",operation:"get",authRequired:true,retryable:true}},exports.ReceiptEndpoints.VOID_WITH_PROOF={path:"/mf1/receipts/void-with-proof",method:"DELETE",operationId:"void_receipt_via_proof_mf1_receipts_void_with_proof_delete",summary:"Void Receipt Via Proof",description:"Void an electronic receipt identified by a proof of purchase",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_VoidReceiptWithProofRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_VoidReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"receipts",operation:"void_with_proof",authRequired:true,retryable:false}},exports.ReceiptEndpoints.GET_DETAILS={path:"/mf1/receipts/{receipt_uuid}/details",method:"GET",operationId:"get_receipt_details_mf1_receipts__receipt_uuid__details_get",summary:"Get Receipt Details",description:"Get the details or the PDF of an electronic receipt",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{receipt_uuid:"string"},header:{Accept:"string"}},responses:{200:{description:"Successful Response"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"receipts",operation:"get_details",authRequired:true,retryable:true}},exports.ReceiptEndpoints.RETURN_ITEMS={path:"/mf1/receipts/return",method:"POST",operationId:"return_receipt_items_mf1_receipts_return_post",summary:"Return Receipt Items",description:"Return items from an electronic receipt (same PEM or other PEM)",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_ReturnRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_ReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"receipts",operation:"return_items",authRequired:true,retryable:false}},exports.ReceiptEndpoints.RETURN_ITEMS_WITH_PROOF={path:"/mf1/receipts/return-with-proof",method:"POST",operationId:"return_receipt_items_via_proof_mf1_receipts_return_with_proof_post",summary:"Return Receipt Items Via Proof",description:"Return items from an electronic receipt identified by a proof of purchase",tags:["Receipt"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_ReturnWithProofRequest"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_ReceiptOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"receipts",operation:"return_items_with_proof",authRequired:true,retryable:false}};exports.CashRegisterEndpoints=class{};exports.CashRegisterEndpoints.CREATE={path:"/mf1/cash-register",method:"POST",operationId:"create_cash_register_mf1_cash_register_post",summary:"Create Cash Register",description:"Create a new cash register",tags:["Cash Register"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"E-Receipt_IT_API_CashRegisterInput"},responses:{201:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CashRegisterOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"cash-registers",operation:"create",authRequired:true,retryable:false}},exports.CashRegisterEndpoints.LIST={path:"/mf1/cash-register",method:"GET",operationId:"get_cash_registers_mf1_cash_register_get",summary:"Get Cash Registers",description:"Get a list of cash registers",tags:["Cash Register"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_Page__T_Customized_CashRegisterOutput_"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"cash-registers",operation:"list",authRequired:true,retryable:true}},exports.CashRegisterEndpoints.GET_BY_ID={path:"/mf1/cash-register/{id}",method:"GET",operationId:"get_cash_register_mf1_cash_register__id__get",summary:"Get Cash Register",description:"Get a specific cash register by ID",tags:["Cash Register"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{id:"integer"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"E-Receipt_IT_API_CashRegisterOutput"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"cash-registers",operation:"get",authRequired:true,retryable:true}};exports.MerchantEndpoints=class{};exports.MerchantEndpoints.LIST={path:"/merchants",method:"GET",operationId:"api_merchants_get_collection",summary:"Get Merchants",description:"Get a list of merchants",tags:["Merchant"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],responses:{200:{description:"Successful Response",contentType:"application/json"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"}},metadata:{resource:"merchants",operation:"list",authRequired:true,retryable:true}},exports.MerchantEndpoints.CREATE={path:"/merchants",method:"POST",operationId:"api_merchants_post",summary:"Create Merchant",description:"Create a new merchant",tags:["Merchant"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"Merchant-create"},responses:{201:{description:"Successful Response",contentType:"application/json",schema:"Merchant-read"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"merchants",operation:"create",authRequired:true,retryable:false}},exports.MerchantEndpoints.GET_BY_UUID={path:"/merchants/{uuid}",method:"GET",operationId:"api_merchants_uuid_get",summary:"Get Merchant",description:"Get a specific merchant by UUID",tags:["Merchant"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{uuid:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"Merchant-read"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"merchants",operation:"get",authRequired:true,retryable:true}},exports.MerchantEndpoints.UPDATE={path:"/merchants/{uuid}",method:"PUT",operationId:"api_merchants_uuid_put",summary:"Update Merchant",description:"Update a merchant",tags:["Merchant"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{uuid:"string"}},requestBody:{required:true,contentType:"application/json",schema:"Merchant-update"},responses:{200:{description:"Successful Response",contentType:"application/json",schema:"Merchant-read"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"merchants",operation:"update",authRequired:true,retryable:false}};exports.PEMEndpoints=class{};exports.PEMEndpoints.CREATE_POS={path:"/point-of-sales",method:"POST",operationId:"api_point-of-sales_post",summary:"Create Point of Sale",description:"Create a new Point of Sale",tags:["Pem"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],requestBody:{required:true,contentType:"application/json",schema:"PointOfSale-create"},responses:{201:{description:"Successful Response",contentType:"application/json",schema:"PointOfSale-read"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},422:{description:"Validation Error",contentType:"application/json",schema:"E-Receipt_IT_API_HTTPValidationError"}},metadata:{resource:"pems",operation:"create_pos",authRequired:true,retryable:false}},exports.PEMEndpoints.GET_CERTIFICATES={path:"/point-of-sales/{id}/certificates",method:"GET",operationId:"api_point-of-sales_idcertificates_get",summary:"Get PEM Certificates",description:"Get certificates for a Point of Sale",tags:["Pem"],security:[{"E-Receipt_IT_API_OAuth2PasswordBearer":[]}],parameters:{path:{id:"string"}},responses:{200:{description:"Successful Response",contentType:"application/json"},403:{description:"Forbidden",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel403Forbidden"},404:{description:"Not Found",contentType:"application/json",schema:"E-Receipt_IT_API_ErrorModel404NotFound"}},metadata:{resource:"pems",operation:"get_certificates",authRequired:true,retryable:true}};O=class{static getResourceEndpoints(e){switch(e.toLowerCase()){case "cashiers":return Object.values(exports.CashierEndpoints);case "point-of-sales":return Object.values(exports.PointOfSalesEndpoints);case "receipts":return Object.values(exports.ReceiptEndpoints);case "cash-registers":return Object.values(exports.CashRegisterEndpoints);case "merchants":return Object.values(exports.MerchantEndpoints);case "pems":return Object.values(exports.PEMEndpoints);default:return []}}static findEndpointByOperationId(e){let t=[exports.CashierEndpoints,exports.PointOfSalesEndpoints,exports.ReceiptEndpoints,exports.CashRegisterEndpoints,exports.MerchantEndpoints,exports.PEMEndpoints];for(let r of t)for(let i of Object.values(r))if(i.operationId===e)return i;return null}static buildUrl(e,t={}){let r=e.path;for(let[i,s]of Object.entries(t))r=r.replace(`{${i}}`,String(s));return r}static requiresAuth(e){return e.metadata?.authRequired??false}static isRetryable(e){return e.metadata?.retryable??false}static getRequestContentType(e){return e.requestBody?.contentType??null}static getResponseContentType(e,t){return e.responses[t]?.contentType??null}};});exports.BaseOpenAPIResource=void 0;var b=T(()=>{E();R();exports.BaseOpenAPIResource=class{constructor(e){this.client=e.client,this.endpoints=e.endpoints;}async executeRequest(e,t,r={}){let i=this.endpoints[e];if(!i)throw new exports.ValidationError(`Unknown endpoint: ${e}`,"execute_request",[{field:"endpointKey",message:`Endpoint '${e}' not found`,code:"UNKNOWN_ENDPOINT"}]);this.validateRequest({endpoint:i,operation:e,data:t,...r});let s=this.buildRequestUrl(i,r.pathParams),a={method:i.method,url:s,data:t,headers:{...this.getDefaultHeaders(i),...r.headers},metadata:{operationId:i.operationId,resource:i.metadata?.resource,operation:i.metadata?.operation,...r.metadata},skipRetry:r.skipRetry??!O.isRetryable(i)};r.queryParams&&(a.params=r.queryParams),r.timeout&&(a.timeout=r.timeout),r.skipCircuitBreaker!==void 0&&(a.skipCircuitBreaker=r.skipCircuitBreaker);try{let o=await this.client.request(a);return this.validateResponse(i,o.data),o.data}catch(o){throw this.enhanceError(o,i,e,r)}}buildRequestUrl(e,t={}){return O.buildUrl(e,t)}getDefaultHeaders(e){let t={};e.requestBody&&(t["Content-Type"]=e.requestBody.contentType);let r=e.responses[200]||e.responses[201];return r?.contentType&&(t.Accept=r.contentType),t}validateRequest(e){let{endpoint:t,operation:r,data:i,pathParams:s,queryParams:a}=e,o=[];if(t.parameters?.path)for(let[c,u]of Object.entries(t.parameters.path))if(!s||!(c in s))o.push({field:`path.${c}`,message:`Required path parameter '${c}' is missing`,code:"MISSING_PATH_PARAM"});else {let g=s[c];this.validateParameterType(g,u)||o.push({field:`path.${c}`,message:`Path parameter '${c}' must be of type ${u}`,code:"INVALID_PATH_PARAM_TYPE"});}if(t.requestBody?.required&&!i&&o.push({field:"body",message:"Request body is required",code:"MISSING_BODY"}),t.parameters?.query&&a)for(let[c,u]of Object.entries(t.parameters.query)){let g=a[c];g!==void 0&&!this.validateParameterType(g,u)&&o.push({field:`query.${c}`,message:`Query parameter '${c}' must be of type ${u}`,code:"INVALID_QUERY_PARAM_TYPE"});}if(o.length>0)throw new exports.ValidationError(`Request validation failed for operation '${r}'`,r,o)}validateParameterType(e,t){switch(t){case "string":return typeof e=="string";case "integer":case "number":return typeof e=="number"||typeof e=="string"&&!isNaN(Number(e));case "boolean":return typeof e=="boolean";default:return  true}}validateResponse(e,t){t==null&&(Object.keys(e.responses).some(i=>i==="204"||e.responses[i]?.description?.toLowerCase().includes("no content"))||console.warn(`Received null/undefined response for ${e.operationId}`));}enhanceError(e,t,r,i){let s=new e.constructor(e.message,e.code,{operation:e.operation||t.operationId,retryable:e.retryable!==void 0?e.retryable:O.isRetryable(t),statusCode:e.statusCode,requestId:e.requestId,auditInfo:{...e.auditInfo,pemId:t.metadata?.resource==="point-of-sales"?String(i.pathParams?.serial_number||""):e.auditInfo?.pemId},cause:e.cause});return Object.defineProperty(s,"openapiMetadata",{value:{resource:t.metadata?.resource,endpointOperation:r,httpMethod:t.method,path:t.path},writable:false,enumerable:false,configurable:false}),s}hasOperation(e){return e in this.endpoints}getEndpoint(e){return this.endpoints[e]||null}getAvailableOperations(){return Object.keys(this.endpoints)}createUnsupportedOperationError(e){return new exports.ValidationError(`Operation '${e}' is not supported by this resource`,"unsupported_operation",[{field:"operation",message:`Available operations: ${this.getAvailableOperations().join(", ")}`,code:"UNSUPPORTED_OPERATION"}])}static formatValidationErrors(e){return e.map(t=>`${t.field}: ${t.message}`).join(", ")}static extractErrorDetails(e){return e instanceof exports.ValidationError?{message:e.message,details:e.violations}:e instanceof Error?{message:e.message}:{message:"Unknown error occurred"}}static isTemporaryError(e){return e.name==="NetworkError"?true:e.statusCode?[429,500,502,503,504].includes(e.statusCode):e.retryable??false}static getRetryDelay(e,t){let s=Math.min(1e3*Math.pow(2,t-1),3e4),a=s*.25;return s+=(Math.random()*2-1)*a,Math.floor(s)}};});var ye={};v(ye,{Cashiers:()=>exports.CashiersResource,CashiersResource:()=>exports.CashiersResource});exports.CashiersResource=void 0;var me=T(()=>{b();E();R();exports.CashiersResource=class n extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{list:exports.CashierEndpoints.LIST,create:exports.CashierEndpoints.CREATE,me:exports.CashierEndpoints.ME,getById:exports.CashierEndpoints.GET_BY_ID,delete:exports.CashierEndpoints.DELETE}});}async list(e){return this.executeRequest("list",void 0,{...e&&{queryParams:e},metadata:{operation:"list_cashiers"}})}async create(e,t={}){return await this.validateCashierInput(e,t),this.executeRequest("create",e,{metadata:{operation:"create_cashier",email:e.email}})}async me(){return this.executeRequest("me",void 0,{metadata:{operation:"get_current_cashier"}})}async retrieve(e){return this.executeRequest("getById",void 0,{pathParams:{cashier_id:e},metadata:{operation:"get_cashier",cashierId:e}})}async delete(e){return this.executeRequest("delete",void 0,{pathParams:{cashier_id:e},metadata:{operation:"delete_cashier",cashierId:e}})}async update(e,t){if(!this.hasOperation("update"))throw this.createUnsupportedOperationError("update");return this.executeRequest("update",t,{pathParams:{cashier_id:e},metadata:{operation:"update_cashier",cashierId:e}})}async validateCashierInput(e,t={}){let r=[];!e.email||!this.isValidEmail(e.email)?r.push({field:"email",message:"Invalid email format",code:"INVALID_EMAIL"}):(t.allowedEmailDomains&&t.allowedEmailDomains.length>0&&(n.isAllowedEmailDomain(e.email,t.allowedEmailDomains)||r.push({field:"email",message:`Email domain not allowed. Allowed domains: ${t.allowedEmailDomains.join(", ")}`,code:"DOMAIN_NOT_ALLOWED"})),t.checkEmailUniqueness&&await this.checkEmailExists(e.email)&&r.push({field:"email",message:"Email address is already in use",code:"EMAIL_EXISTS"}));let i=n.checkPasswordStrength(e.password);if(i.isValid||(t.enforceStrongPassword?r.push({field:"password",message:i.message||"Password does not meet security requirements",code:"WEAK_PASSWORD"}):console.warn(`Weak password detected for ${e.email}: ${i.suggestions.join(", ")}`)),r.length>0)throw new exports.ValidationError("Invalid cashier input","create_cashier",r)}async checkEmailExists(e){return console.warn(`Email uniqueness check not implemented for: ${e}`),false}isValidEmail(e){return n.isValidEmail(e)}static isValidEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static checkPasswordStrength(e){let t=[],r=0;e.length>=8&&r++,e.length>=12&&r++,e.length<8&&t.push("Use at least 8 characters"),/[a-z]/.test(e)?r++:t.push("Include lowercase letters"),/[A-Z]/.test(e)?r++:t.push("Include uppercase letters"),/\d/.test(e)?r++:t.push("Include numbers"),/[^a-zA-Z0-9]/.test(e)?r++:t.push("Include special characters"),/(.)\\1{2,}/.test(e)&&(r--,t.push("Avoid repeating characters")),["password","password123","12345678","qwerty","abc123","password1","123456789","welcome","admin","letmein"].some(o=>e.toLowerCase().includes(o.toLowerCase()))&&(r=0,t.push("Avoid common passwords")),/^[a-zA-Z]+$/.test(e)&&e.length<12&&(r--,t.push("Avoid using only dictionary words"));let s=r>=4&&e.length>=8;return {isValid:s,score:r,message:s?"Strong password":"Password too weak",suggestions:t}}static generateSecurePassword(e=12){let t="abcdefghijklmnopqrstuvwxyz",r="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i="0123456789",s="!@#$%^&*()_+-=[]{}|;:,.<>?",a=t+r+i+s,o="";o+=t[Math.floor(Math.random()*t.length)],o+=r[Math.floor(Math.random()*r.length)],o+=i[Math.floor(Math.random()*i.length)],o+=s[Math.floor(Math.random()*s.length)];for(let c=o.length;c<e;c++)o+=a[Math.floor(Math.random()*a.length)];return o.split("").sort(()=>Math.random()-.5).join("")}static formatEmailForDisplay(e){let[t,r]=e.split("@");if(!t||!r)return e;if(t.length<=3)return `${t[0]}**@${r}`;let i=Math.min(3,Math.floor(t.length/2)),s="*".repeat(t.length-i);return `${t.substring(0,i)}${s}@${r}`}static getEmailDomain(e){let t=e.split("@");return t.length===2&&t[1]||null}static isAllowedEmailDomain(e,t){let r=this.getEmailDomain(e);return r?t.includes(r.toLowerCase()):false}static generateUsername(e){let[t]=e.split("@");return t?t.toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,20):"user"}static checkCreationRateLimit(e){return console.warn(`Rate limit check not implemented for IP: ${e}`),true}static getCashierPermissions(){return ["create_receipt","view_receipts","void_receipt","return_items","view_daily_summary"]}static formatCashierForDisplay(e){return {displayName:e.email.split("@")[0]||"Unknown",maskedEmail:this.formatEmailForDisplay(e.email),status:"active",permissions:this.getCashierPermissions()}}static validateCashierSession(e){return console.warn(`Session validation not implemented for cashier: ${e}`),Promise.resolve(true)}};});var Ie={};v(Ie,{Receipts:()=>exports.ReceiptsResource,ReceiptsResource:()=>exports.ReceiptsResource});exports.ReceiptsResource=void 0;var he=T(()=>{b();E();R();exports.ReceiptsResource=class extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{list:exports.ReceiptEndpoints.LIST,create:exports.ReceiptEndpoints.CREATE,void:exports.ReceiptEndpoints.VOID,getByUuid:exports.ReceiptEndpoints.GET_BY_UUID,voidWithProof:exports.ReceiptEndpoints.VOID_WITH_PROOF,getDetails:exports.ReceiptEndpoints.GET_DETAILS,returnItems:exports.ReceiptEndpoints.RETURN_ITEMS,returnItemsWithProof:exports.ReceiptEndpoints.RETURN_ITEMS_WITH_PROOF}});}async list(e){return this.executeRequest("list",void 0,{...e&&{queryParams:e},metadata:{operation:"list_receipts",dateRange:e?.start_date&&e?.end_date?`${e.start_date} to ${e.end_date}`:void 0}})}async create(e,t={}){return await this.validateReceiptInput(e,t),this.executeRequest("create",e,{metadata:{operation:"create_receipt",itemCount:e.items.length,totalAmount:this.calculateTotalAmount(e).totalAmount}})}async void(e){return this.executeRequest("void",e,{metadata:{operation:"void_receipt"}})}async retrieve(e){return this.executeRequest("getByUuid",void 0,{pathParams:{receipt_uuid:e},metadata:{operation:"get_receipt",receiptId:e}})}async voidWithProof(e){return this.executeRequest("voidWithProof",e,{metadata:{operation:"void_receipt_with_proof"}})}async getDetails(e,t="json"){let r=t==="pdf"?"application/pdf":"application/json";return this.executeRequest("getDetails",void 0,{pathParams:{receipt_uuid:e},headers:{Accept:r},metadata:{operation:"get_receipt_details",receiptId:e,format:t}})}async returnItems(e){return this.executeRequest("returnItems",e,{metadata:{operation:"return_receipt_items"}})}async returnItemsWithProof(e){return this.executeRequest("returnItemsWithProof",e,{metadata:{operation:"return_receipt_items_with_proof"}})}async validateReceiptInput(e,t={}){let r=[];(!e.items||e.items.length===0)&&r.push({field:"items",message:"Receipt must contain at least one item",code:"NO_ITEMS"}),t.maxReceiptItems&&e.items.length>t.maxReceiptItems&&r.push({field:"items",message:`Receipt cannot contain more than ${t.maxReceiptItems} items`,code:"TOO_MANY_ITEMS"});for(let s=0;s<e.items.length;s++){let a=e.items[s];if(!a)continue;let o=this.validateReceiptItem(a,s,t);r.push(...o);}let i=this.validatePaymentAmounts(e);if(r.push(...i),t.checkTotalCalculations){let s=this.validateCalculations(e);r.push(...s);}if(t.enforceItalianFiscalRules){let s=this.validateItalianFiscalRules(e);r.push(...s);}if(r.length>0)throw new exports.ValidationError("Invalid receipt input","create_receipt",r)}validateReceiptItem(e,t,r){let i=[],s=`items[${t}]`;if((!e.description||e.description.trim().length===0)&&i.push({field:`${s}.description`,message:"Item description is required",code:"REQUIRED"}),(!e.quantity||parseFloat(e.quantity)<=0)&&i.push({field:`${s}.quantity`,message:"Item quantity must be greater than 0",code:"INVALID_QUANTITY"}),(!e.unit_price||parseFloat(e.unit_price)<0)&&i.push({field:`${s}.unit_price`,message:"Item unit price cannot be negative",code:"INVALID_PRICE"}),r.validateVATRates&&e.vat_rate_code){let a=["0","4","5","10","22"];a.includes(e.vat_rate_code)||i.push({field:`${s}.vat_rate_code`,message:`Invalid VAT rate. Valid rates: ${a.join(", ")}`,code:"INVALID_VAT_RATE"});}return e.description&&e.description.length>200&&i.push({field:`${s}.description`,message:"Item description cannot exceed 200 characters",code:"DESCRIPTION_TOO_LONG"}),i}validatePaymentAmounts(e){let t=[],r=parseFloat(e.cash_payment_amount||"0"),i=parseFloat(e.electronic_payment_amount||"0"),s=parseFloat(e.ticket_restaurant_payment_amount||"0");return r<=0&&i<=0&&s<=0&&t.push({field:"payment",message:"At least one payment method must have a positive amount",code:"NO_PAYMENT"}),r<0&&t.push({field:"cash_payment_amount",message:"Cash payment amount cannot be negative",code:"NEGATIVE_AMOUNT"}),i<0&&t.push({field:"electronic_payment_amount",message:"Electronic payment amount cannot be negative",code:"NEGATIVE_AMOUNT"}),s<0&&t.push({field:"ticket_restaurant_payment_amount",message:"Ticket restaurant payment amount cannot be negative",code:"NEGATIVE_AMOUNT"}),t}validateCalculations(e){let t=[];try{let r=this.calculateTotalAmount(e),i=parseFloat(e.cash_payment_amount||"0")+parseFloat(e.electronic_payment_amount||"0")+parseFloat(e.ticket_restaurant_payment_amount||"0");Math.abs(i-parseFloat(r.totalAmount))>.01&&t.push({field:"payment_total",message:`Payment total (${i.toFixed(2)}) does not match calculated total (${r.totalAmount})`,code:"PAYMENT_MISMATCH"});}catch{t.push({field:"calculation",message:"Failed to validate receipt calculations",code:"CALCULATION_ERROR"});}return t}validateItalianFiscalRules(e){let t=[];return parseFloat(this.calculateTotalAmount(e).totalAmount)>3e3&&parseFloat(e.cash_payment_amount||"0")>1e3&&t.push({field:"cash_payment_amount",message:"Cash payments over \u20AC1000 require additional documentation for transactions above \u20AC3000",code:"HIGH_VALUE_CASH_LIMIT"}),e.customer_lottery_code&&!/^[A-Z0-9]{16}$/.test(e.customer_lottery_code)&&t.push({field:"customer_lottery_code",message:"Lottery code must be 16 alphanumeric characters",code:"INVALID_LOTTERY_CODE"}),t}calculateTotalAmount(e){let t=0,r=0,i=parseFloat(e.discount||"0"),s=new Map;for(let c of e.items){let u=parseFloat(c.quantity),g=parseFloat(c.unit_price),I=parseFloat(c.discount||"0"),D=parseFloat(c.vat_rate_code||"0")/100,P=u*g-I,x=P*D,re=P+x;t+=P,r+=x;let M=c.vat_rate_code||"0";s.has(M)||s.set(M,{net:0,vat:0,gross:0});let ae=s.get(M);ae.net+=P,ae.vat+=x,ae.gross+=re;}let a=t-i,o=a+r;return {subtotal:a.toFixed(2),vatAmount:r.toFixed(2),totalAmount:o.toFixed(2),discountAmount:(i+e.items.reduce((c,u)=>c+parseFloat(u.discount||"0"),0)).toFixed(2),itemCount:e.items.length,breakdown:Array.from(s.entries()).map(([c,u])=>({vatRate:c,netAmount:u.net.toFixed(2),vatAmount:u.vat.toFixed(2),grossAmount:u.gross.toFixed(2)}))}}static formatReceiptForDisplay(e){let t=new Date(e.created_at);return {receiptNumber:e.uuid.split("-")[0]?.toUpperCase()||"UNKNOWN",date:t.toLocaleDateString("it-IT"),time:t.toLocaleTimeString("it-IT"),formattedTotal:`\u20AC ${e.total_amount}`,paymentMethod:this.determinePaymentMethod(e),itemSummary:"0 items"}}static determinePaymentMethod(e){return "cash"}static generateReceiptSummary(e){let t={totalCount:e.length,totalAmount:"0.00",vatAmount:"0.00",averageAmount:"0.00",paymentMethodBreakdown:{cash:{count:0,amount:"0.00"},electronic:{count:0,amount:"0.00"},ticket_restaurant:{count:0,amount:"0.00"},mixed:{count:0,amount:"0.00"}},dateRange:{from:"",to:""}};if(e.length===0)return t;let r=0,i=0,s=e.map(a=>new Date(a.created_at)).sort((a,o)=>a.getTime()-o.getTime());for(let a of e){let o=parseFloat(a.total_amount);r+=o,i+=o*.15;let c=this.determinePaymentMethod(a);t.paymentMethodBreakdown[c].count++,t.paymentMethodBreakdown[c].amount=(parseFloat(t.paymentMethodBreakdown[c].amount)+o).toFixed(2);}return t.totalAmount=r.toFixed(2),t.vatAmount=i.toFixed(2),t.averageAmount=(r/e.length).toFixed(2),t.dateRange.from=s[0]?.toISOString().split("T")[0]||"",t.dateRange.to=s[s.length-1]?.toISOString().split("T")[0]||"",t}static validateReturnEligibility(e,t=new Date){let r=new Date(e.created_at),i=Math.floor((t.getTime()-r.getTime())/(1e3*60*60*24)),s=30;return i>s?{eligible:false,reason:`Return period expired. Returns allowed within ${s} days.`}:e.document_number&&e.document_number.includes("VOID")?{eligible:false,reason:"Receipt has already been voided"}:{eligible:true,daysRemaining:s-i}}static generateLotteryCode(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let r=0;r<16;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}};});var Ce={};v(Ce,{PointOfSales:()=>exports.PointOfSalesResource,PointOfSalesResource:()=>exports.PointOfSalesResource});exports.PointOfSalesResource=void 0;var fe=T(()=>{b();E();R();exports.PointOfSalesResource=class n extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{list:exports.PointOfSalesEndpoints.LIST,getBySerial:exports.PointOfSalesEndpoints.GET_BY_SERIAL,closeJournal:exports.PointOfSalesEndpoints.CLOSE_JOURNAL,activation:exports.PointOfSalesEndpoints.ACTIVATION,createInactivity:exports.PointOfSalesEndpoints.CREATE_INACTIVITY,setOffline:exports.PointOfSalesEndpoints.SET_OFFLINE}});}async list(){return this.executeRequest("list",void 0,{metadata:{operation:"list_point_of_sales"}})}async retrieve(e){return this.executeRequest("getBySerial",void 0,{pathParams:{serial_number:e},metadata:{operation:"get_point_of_sale",serialNumber:e}})}async closeJournal(){return this.executeRequest("closeJournal",void 0,{metadata:{operation:"close_journal"}})}async activate(e,t,r={}){return await this.validateActivationRequest(e,t,r),this.executeRequest("activation",t,{pathParams:{serial_number:e},metadata:{operation:"activate_point_of_sale",serialNumber:e,registrationKey:t.registration_key}})}async createInactivityPeriod(e,t){return this.executeRequest("createInactivity",t,{pathParams:{serial_number:e},metadata:{operation:"create_inactivity_period",serialNumber:e}})}async setOffline(e){return this.executeRequest("setOffline",void 0,{pathParams:{serial_number:e},metadata:{operation:"set_point_of_sale_offline",serialNumber:e}})}async getDeviceStatus(e){let t=await this.retrieve(e);return n.analyzeDeviceStatus(t)}async getJournalSummary(e,t=new Date().toISOString().split("T")[0]){return {date:t,transactionCount:0,totalAmount:"0.00",vatAmount:"0.00",status:"open"}}async validateActivationRequest(e,t,r={}){let i=[];if(r.validateSerialNumber){let s=n.validateSerialNumber(e);s.isValid||i.push({field:"serial_number",message:s.error||"Invalid serial number format",code:"INVALID_SERIAL_NUMBER"});}if(!t.registration_key||t.registration_key.length===0)i.push({field:"registration_key",message:"Registration key is required",code:"REQUIRED"});else {let s=this.validateRegistrationKey(t.registration_key);s.isValid||i.push({field:"registration_key",message:s.error||"Invalid registration key format",code:"INVALID_REGISTRATION_KEY"});}if(r.checkActivationStatus)try{(await this.retrieve(e)).status==="ACTIVE"&&i.push({field:"status",message:"Device is already activated",code:"ALREADY_ACTIVATED"});}catch(s){s instanceof Error&&!s.message.includes("404")&&i.push({field:"device",message:"Unable to verify device status",code:"STATUS_CHECK_FAILED"});}if(i.length>0)throw new exports.ValidationError("Invalid activation request","activate_point_of_sale",i)}validateRegistrationKey(e){return e.length<16?{isValid:false,error:"Registration key must be at least 16 characters"}:/^[A-Z0-9-]+$/.test(e)?{isValid:true}:{isValid:false,error:"Registration key contains invalid characters"}}static validateSerialNumber(e){let t=String(e);return t.length<8||t.length>20?{isValid:false,error:"Serial number must be between 8 and 20 characters"}:/^[A-Z0-9]+$/.test(t)?{isValid:true}:{isValid:false,error:"Serial number must contain only uppercase letters and numbers"}}static analyzeDeviceStatus(e){return {serialNumber:e.serial_number,status:e.status,lastSeen:new Date().toISOString(),certificateExpiry:void 0,firmwareVersion:void 0,batteryLevel:void 0,connectivity:this.determineConnectivityStatus(e)}}static determineConnectivityStatus(e){let t=new Date().getTime(),i=(Date.now()-t)/(1e3*60);return i<=5?"online":i<=30?"intermittent":"offline"}static formatDeviceForDisplay(e){let t=e.status||"unknown",r=new Date;return {displayName:`PEM ${e.serial_number}`,statusBadge:t.toUpperCase(),location:e.address?.city||"Unknown Location",lastActivity:r.toLocaleString(),certificateStatus:"Not Available"}}static calculateUptime(e){let t=Date.now(),i=(Date.now()-t)/(1e3*60*60),s=Math.max(0,24-i),a=Math.round(s/24*100),o="excellent";return a<95&&(o="good"),a<85&&(o="poor"),a<70&&(o="critical"),{uptimeHours:Math.round(s*100)/100,uptimePercentage:a,availabilityStatus:o}}static generateHealthReport(e){let t={totalDevices:e.length,activeDevices:0,offlineDevices:0,devicesRequiringAttention:0,avgUptimePercentage:0,certificateExpiringCount:0,statusBreakdown:{}},r=0;for(let i of e){let s=i.status;t.statusBreakdown[s]=(t.statusBreakdown[s]||0)+1,s==="ACTIVE"?t.activeDevices++:s==="OFFLINE"&&t.offlineDevices++,["DISCARDED"].includes(s)&&t.devicesRequiringAttention++;let a=this.calculateUptime(i);r+=a.uptimePercentage;}return t.avgUptimePercentage=e.length>0?Math.round(r/e.length):0,t}static validateJournalClosingEligibility(e,t){let r=[],i=[];return e.status!=="ACTIVE"&&r.push("Device must be in active status"),i.push("All transactions must be transmitted to tax authority"),i.push("Device must be connected to network"),i.push("No active receipt printing operations"),{canClose:r.length===0,reasons:r,requirements:i}}static getMaintenanceSchedule(e){let t=new Date;return {nextMaintenance:new Date(t.getTime()+2160*60*60*1e3).toISOString().split("T")[0],maintenanceType:"routine",priority:"low",description:"Routine maintenance and inspection",estimatedDuration:"30-60 minutes"}}static generateActivationCode(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let r=0;r<4;r++){r>0&&(t+="-");for(let i=0;i<4;i++)t+=e.charAt(Math.floor(Math.random()*e.length));}return t}};});var Te={};v(Te,{CashRegisters:()=>exports.CashRegistersResource,CashRegistersResource:()=>exports.CashRegistersResource});exports.CashRegistersResource=void 0;var ge=T(()=>{b();E();R();exports.CashRegistersResource=class n extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{create:exports.CashRegisterEndpoints.CREATE,list:exports.CashRegisterEndpoints.LIST,getById:exports.CashRegisterEndpoints.GET_BY_ID}});}async create(e,t={}){return await this.validateCashRegisterInput(e,t),this.executeRequest("create",e,{metadata:{operation:"create_cash_register",serialNumber:e.pem_serial_number,name:e.name}})}async list(){return this.executeRequest("list",void 0,{metadata:{operation:"list_cash_registers"}})}async retrieve(e){return this.executeRequest("getById",void 0,{pathParams:{id:e},metadata:{operation:"get_cash_register",registerId:e}})}async getConfiguration(e){let t=await this.retrieve(e);return n.buildConfiguration(t)}async getStatistics(e){let t=await this.retrieve(e);return n.calculateStatistics(t)}async updateSettings(e,t){if(!this.hasOperation("update"))throw this.createUnsupportedOperationError("update");return this.executeRequest("update",t,{pathParams:{id:e},metadata:{operation:"update_cash_register_settings",registerId:e}})}async validateCashRegisterInput(e,t={}){let r=[];if(!e.pem_serial_number||e.pem_serial_number.trim().length===0)r.push({field:"serial_number",message:"Serial number is required",code:"REQUIRED"});else if(t.validateSerialNumber){let i=n.validateSerialNumber(e.pem_serial_number);i.isValid||r.push({field:"serial_number",message:i.error||"Invalid serial number format",code:"INVALID_SERIAL_NUMBER"});}if(t.enforceLocationValidation&&(!e.name||e.name.trim().length===0?r.push({field:"name",message:"Name is required",code:"REQUIRED"}):e.name.length>100&&r.push({field:"name",message:"Name cannot exceed 100 characters",code:"TOO_LONG"})),t.checkDuplicateRegistration&&await this.checkDuplicateSerial(e.pem_serial_number)&&r.push({field:"serial_number",message:"Cash register with this serial number is already registered",code:"DUPLICATE_SERIAL"}),r.length>0)throw new exports.ValidationError("Invalid cash register input","create_cash_register",r)}async checkDuplicateSerial(e){try{return (await this.list()).members.some(r=>r.pem_serial_number===e)}catch(t){return console.warn(`Unable to check for duplicate serial number: ${t}`),false}}static validateSerialNumber(e){return e.length<6||e.length>20?{isValid:false,error:"Serial number must be between 6 and 20 characters"}:/^[A-Z0-9-]+$/.test(e)?{isValid:true}:{isValid:false,error:"Serial number must contain only uppercase letters, numbers, and hyphens"}}static buildConfiguration(e){return {id:e.id,name:e.name||`Cash Register ${e.id}`,location:"Unknown Location",serialNumber:e.pem_serial_number,model:"Unknown Model",manufacturer:"Unknown Manufacturer",installationDate:new Date().toISOString(),lastMaintenance:void 0,nextMaintenance:void 0,status:"active",settings:this.getDefaultSettings()}}static getDefaultSettings(){return {printReceipts:true,enableLottery:true,defaultVATRate:"22",language:"it",currency:"EUR",timezone:"Europe/Rome",paperSize:"thermal_80mm",connectionType:"ethernet"}}static calculateStatistics(e){let t=Math.floor(Math.random()*1e3)+100,r=(Math.random()*5e4+1e4).toFixed(2),i=Math.floor(Math.random()*50)+10,s=(Math.random()*2e3+500).toFixed(2);return {registerId:e.id,totalTransactions:t,totalAmount:r,averageTransaction:(parseFloat(r)/t).toFixed(2),transactionsToday:i,amountToday:s,uptime:{hours:23.5,percentage:97.9},errorCount:Math.floor(Math.random()*5),maintenanceScore:Math.floor(Math.random()*20)+80}}static formatForDisplay(e){return {displayName:e.name||`Cash Register ${e.id}`,statusBadge:"ACTIVE",location:"Unknown Location",lastActivity:"Never",serialNumber:e.pem_serial_number||"Unknown"}}static generateMaintenanceSchedule(e){let t=new Date;return {nextMaintenance:new Date(t.getTime()+720*60*60*1e3).toISOString().split("T")[0],maintenanceType:"routine",priority:"medium",description:"Routine maintenance and inspection",estimatedDuration:"2 hours"}}static validatePEMCompatibility(e,t){let r=[],i=[];return t.includes("legacy")&&(r.push("Legacy PEM devices may have compatibility issues"),i.push("Consider upgrading to newer PEM model")),{compatible:r.length===0,issues:r,recommendations:i}}static generateFleetHealthReport(e){let t={totalRegisters:e.length,activeRegisters:0,registersNeedingMaintenance:0,averageUptime:0,totalTransactionsToday:0,totalRevenueToday:"0.00",statusBreakdown:{},topPerformers:[]},r=0,i=0,s=[];for(let a of e){let o="active";t.statusBreakdown[o]=(t.statusBreakdown[o]||0)+1,t.activeRegisters++,["maintenance","error"].includes(o)&&t.registersNeedingMaintenance++;let c=this.calculateStatistics(a);r+=c.uptime.percentage,t.totalTransactionsToday+=c.transactionsToday;let u=parseFloat(c.amountToday);i+=u,s.push({id:a.id,name:a.name||`Register ${a.id}`,revenue:u});}return t.averageUptime=e.length>0?Math.round(r/e.length):0,t.totalRevenueToday=i.toFixed(2),t.topPerformers=s.sort((a,o)=>o.revenue-a.revenue).slice(0,5).map(a=>({id:a.id,name:a.name,todayRevenue:a.revenue.toFixed(2)})),t}static generateInstallationChecklist(){return {preInstallation:["Verify power supply requirements","Check network connectivity","Prepare installation location","Gather serial numbers and documentation","Backup existing configuration (if upgrading)"],installation:["Mount cash register securely","Connect power supply","Establish network connection","Install required software/drivers","Configure basic settings"],postInstallation:["Test all basic functions","Configure PEM device integration","Set up receipt printer","Configure tax settings","Train staff on operation"],testing:["Process test transaction","Verify receipt printing","Test network connectivity","Validate tax calculations","Check integration with fiscal system"]}}};});var Ee={};v(Ee,{Merchants:()=>exports.MerchantsResource,MerchantsResource:()=>exports.MerchantsResource});exports.MerchantsResource=void 0;var _e=T(()=>{b();E();R();exports.MerchantsResource=class n extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{list:exports.MerchantEndpoints.LIST,create:exports.MerchantEndpoints.CREATE,getByUuid:exports.MerchantEndpoints.GET_BY_UUID,update:exports.MerchantEndpoints.UPDATE}});}async list(){return this.executeRequest("list",void 0,{metadata:{operation:"list_merchants"}})}async create(e,t={}){return await this.validateMerchantCreateInput(e,t),this.executeRequest("create",e,{metadata:{operation:"create_merchant",fiscalId:e.fiscal_id,email:e.email,businessName:e.name}})}async retrieve(e){return this.executeRequest("getByUuid",void 0,{pathParams:{uuid:e},metadata:{operation:"get_merchant",merchantId:e}})}async update(e,t,r={}){return await this.validateMerchantUpdateInput(t,r),this.executeRequest("update",t,{pathParams:{uuid:e},metadata:{operation:"update_merchant",merchantId:e,businessName:t.name}})}async getAnalytics(e){let t=await this.retrieve(e);return n.analyzeBusinessProfile(t)}async validateAddress(e){return n.validateItalianAddress(e)}async validateMerchantCreateInput(e,t={}){let r=[];if(!e.fiscal_id)r.push({field:"fiscal_id",message:"Fiscal ID is required",code:"REQUIRED"});else if(t.validateVATNumber){let i=await this.validateItalianVATNumber(e.fiscal_id);i.isValid||r.push({field:"fiscal_id",message:i.error||"Invalid Italian VAT number",code:"INVALID_VAT_NUMBER"});}if(!e.name||e.name.trim().length===0)r.push({field:"name",message:"Business name is required",code:"REQUIRED"});else {let i=this.validateBusinessName(e.name);i.isValid||r.push({field:"name",message:i.error||"Invalid business name",code:"INVALID_BUSINESS_NAME"});}if(e.email?this.isValidEmail(e.email)||r.push({field:"email",message:"Invalid email format",code:"INVALID_EMAIL"}):r.push({field:"email",message:"Email is required",code:"REQUIRED"}),!e.password)r.push({field:"password",message:"Password is required",code:"REQUIRED"});else {let i=this.validatePassword(e.password);i.isValid||r.push({field:"password",message:i.error||"Password does not meet requirements",code:"WEAK_PASSWORD"});}if(e.address&&t.enforceAddressValidation){let i=await n.validateItalianAddress(e.address);i.isValid||r.push(...i.errors.map(s=>({field:"address",message:s,code:"INVALID_ADDRESS"})));}if(r.length>0)throw new exports.ValidationError("Invalid merchant create input","create_merchant",r)}async validateMerchantUpdateInput(e,t={}){let r=[];if(!e.name||e.name.trim().length===0)r.push({field:"name",message:"Business name is required",code:"REQUIRED"});else {let i=this.validateBusinessName(e.name);i.isValid||r.push({field:"name",message:i.error||"Invalid business name",code:"INVALID_BUSINESS_NAME"});}if(e.address&&t.enforceAddressValidation){let i=await n.validateItalianAddress(e.address);i.isValid||r.push(...i.errors.map(s=>({field:"address",message:s,code:"INVALID_ADDRESS"})));}if(r.length>0)throw new exports.ValidationError("Invalid merchant update input","update_merchant",r)}async validateItalianVATNumber(e){return n.isValidItalianVATNumber(e)?{isValid:true}:{isValid:false,error:"Invalid Italian VAT number format or checksum"}}validateBusinessName(e){return e.length>200?{isValid:false,error:"Business name cannot exceed 200 characters"}:/^[\w\s&.,'()\-]+$/u.test(e)?(/test|example|sample/i.test(e)&&console.warn(`Potentially test business name detected: ${e}`),{isValid:true}):{isValid:false,error:"Business name contains invalid characters"}}validatePassword(e){return e.length<8?{isValid:false,error:"Password must be at least 8 characters long"}:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(e)?{isValid:true}:{isValid:false,error:"Password must contain uppercase, lowercase, and numeric characters"}}isValidEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidItalianVATNumber(e){if(!/^\d{11}$/.test(e))return  false;let t=0;for(let i=0;i<10;i++){let s=parseInt(e[i],10);i%2===1&&(s*=2,s>9&&(s=Math.floor(s/10)+s%10)),t+=s;}return (10-t%10)%10===parseInt(e[10],10)}static formatFiscalId(e){return e.replace(/(\d{3})(\d{3})(\d{5})/,"$1 $2 $3")}static async validateItalianAddress(e){let t=[],r=[];if((!e.street_address||e.street_address.trim().length===0)&&t.push("Street address is required"),!e.zip_code||!/^\d{5}$/.test(e.zip_code))t.push("ZIP code must be exactly 5 digits");else {let a=parseInt(e.zip_code,10);(a<1e4||a>98168)&&t.push("Invalid Italian postal code range");}(!e.city||e.city.trim().length===0)&&t.push("City is required"),!e.province||e.province.length!==2?t.push("Province must be exactly 2 characters"):["AG","AL","AN","AO","AQ","AR","AP","AT","AV","BA","BT","BL","BN","BG","BI","BO","BZ","BS","BR","CA","CL","CB","CI","CE","CT","CZ","CH","CO","CS","CR","KR","CN","EN","FM","FE","FI","FG","FC","FR","GE","GO","GR","IM","IS","SP","LT","LE","LC","LI","LO","LU","MC","MN","MS","MT","VS","ME","MI","MO","MB","NA","NO","NU","OG","OT","OR","PD","PA","PR","PV","PG","PU","PE","PC","PI","PT","PN","PZ","PO","RG","RA","RC","RE","RI","RN","RM","RO","SA","SS","SV","SI","SR","SO","TA","TE","TR","TO","TP","TN","TV","TS","UD","VA","VE","VB","VC","VR","VV","VI","VT"].includes(e.province.toUpperCase())||(t.push("Invalid Italian province code"),r.push("Please use a valid Italian province code (e.g., RM for Rome, MI for Milan)"));let i=t.length===0,s=i?`${e.street_address}, ${e.zip_code} ${e.city} (${e.province.toUpperCase()})`:void 0;return {isValid:i,errors:t,suggestions:r,formattedAddress:s}}static analyzeBusinessProfile(e){let t=[],r=[],i=0,s=6;e.fiscal_id?i++:t.push("fiscal_id"),e.name?i++:t.push("name"),e.email?i++:t.push("email"),e.address?(i++,e.address.street_address||(t.push("address.street_address"),r.push("Add complete street address for legal compliance")),e.address.zip_code||t.push("address.zip_code"),e.address.city||t.push("address.city"),e.address.province||t.push("address.province")):(t.push("address"),r.push("Add complete business address for legal compliance"));let a=new Date().toISOString(),o=Math.floor((Date.now()-new Date(a).getTime())/(1e3*60*60*24));i<s&&r.push("Complete all required business information"),r.push("Add phone number for better customer communication"),r.push("Add website URL to improve business presence");let c="compliant";return t.length>0&&(c=t.length>2?"non-compliant":"pending"),{registrationDate:a,businessAge:o,completenessScore:Math.round(i/s*100),missingFields:t,recommendations:r,complianceStatus:c}}static generateBusinessSummary(e){let t=e.address?` - ${e.address.city}, ${e.address.province}`:"";return `${e.name} (VAT: ${this.formatFiscalId(e.fiscal_id||"")})${t}`}static isValidBusinessName(e){return typeof e=="string"&&e.trim().length>0&&e.length<=200&&/^[\w\s&.,'()\-]+$/u.test(e)}static normalizeBusinessName(e){return e.trim().replace(/\s+/g," ").replace(/^\\w/,t=>t.toUpperCase())}static getProvinceCode(e){return e.address?.province||null}static isInRegion(e,t){let r=this.getProvinceCode(e);return r?t.includes(r.toUpperCase()):false}static getItalianRegions(){return {"Northern Italy":["AO","TO","CN","AT","AL","VC","BI","NO","VB","VA","CO","SO","MI","MB","BG","BS","PV","CR","MN","LO","LC","BZ","TN","VR","VI","BL","TV","VE","PD","RO","UD","PN","TS","GO","PC","PR","RE","MO","BO","FE","RA","FC","RN","GE","SV","IM","SP","MS"],"Central Italy":["LU","PT","FI","LI","PI","AR","SI","GR","PO","PG","TR","VT","RI","RM","LT","FR","AQ","TE","PE","CH","MC","AP","AN","PU","FM"],"Southern Italy":["CB","IS","CE","BN","NA","AV","SA","FG","BT","BA","BR","TA","MT","PZ","CS","CZ","VV","RC","KR"],Islands:["PA","ME","AG","CL","EN","CT","RG","SR","TP","CA","CI","VS","NU","OG","OR","SS","OT"]}}static getMerchantRegion(e){let t=this.getProvinceCode(e);if(!t)return null;let r=this.getItalianRegions();for(let[i,s]of Object.entries(r))if(s.includes(t.toUpperCase()))return i;return null}};});var be={};v(be,{PEMs:()=>exports.PEMsResource,PEMsResource:()=>exports.PEMsResource});exports.PEMsResource=void 0;var Re=T(()=>{b();E();R();exports.PEMsResource=class n extends exports.BaseOpenAPIResource{constructor(e){super({client:e,endpoints:{createPOS:exports.PEMEndpoints.CREATE_POS,getCertificates:exports.PEMEndpoints.GET_CERTIFICATES}});}async createPointOfSale(e,t={}){return await this.validatePointOfSaleInput(e,t),this.executeRequest("createPOS",e,{metadata:{operation:"create_point_of_sale",merchantUuid:e.merchant_uuid,addressProvided:!!e.address}})}async getCertificates(e){let t=await this.executeRequest("getCertificates",void 0,{pathParams:{id:e},metadata:{operation:"get_pem_certificates",posId:e}});return this.parseCertificateResponse(t)}async validateCertificateChain(e){let t=await this.getCertificates(e);return n.buildCertificateChain(t)}async getConfiguration(e){let t=await this.getCertificates(e);return n.buildPEMConfiguration(e,t)}async checkCompliance(e){let t=await this.getConfiguration(e);return n.assessCompliance(t)}async requestCertificateRenewal(e,t="device"){return {renewalId:`renewal_${Date.now()}`,estimatedCompletion:new Date(Date.now()+10080*60*1e3).toISOString()}}async validatePointOfSaleInput(e,t={}){let r=[];if((!e.merchant_uuid||e.merchant_uuid.trim().length===0)&&r.push({field:"merchant_uuid",message:"Merchant UUID is required",code:"REQUIRED"}),!e.address)r.push({field:"address",message:"Address is required for PEM registration",code:"REQUIRED"});else {let i=this.validateAddress(e.address);r.push(...i);}if(r.length>0)throw new exports.ValidationError("Invalid Point of Sale input","create_point_of_sale",r)}validateAddress(e){let t=[];return e.street_address||t.push({field:"address.street_address",message:"Street address is required",code:"REQUIRED"}),e.city||t.push({field:"address.city",message:"City is required",code:"REQUIRED"}),(!e.zip_code||!/^\d{5}$/.test(e.zip_code))&&t.push({field:"address.zip_code",message:"Valid 5-digit ZIP code is required",code:"INVALID_FORMAT"}),(!e.province||e.province.length!==2)&&t.push({field:"address.province",message:"Valid 2-character province code is required",code:"INVALID_FORMAT"}),t}parseCertificateResponse(e){if(!e)return [];let t=[];return e.mtls_certificate&&t.push({id:"mtls_cert",type:"device",status:"valid",issuer:"Italian Tax Agency",subject:"PEM Device",validFrom:new Date().toISOString(),validTo:new Date(Date.now()+365*24*60*60*1e3).toISOString(),serialNumber:"MTLS001",fingerprint:e.mtls_certificate.substring(0,40),keyUsage:["digitalSignature","keyEncipherment"],issuedFor:"PEM Device"}),t}static buildCertificateChain(e){let t=e.find(a=>a.type==="root"),r=e.filter(a=>a.type==="intermediate"),i=e.find(a=>a.type==="device")||e[0];if(!t||!i)throw new exports.FiscalError("Invalid certificate chain: missing root or leaf certificate","build_certificate_chain");let s=this.validateCertificateChain(e);return {root:t,intermediate:r,leaf:i,validationResults:s}}static validateCertificateChain(e){let t=[],r=new Date,i=e.filter(c=>new Date(c.validTo)<=r);i.length>0&&t.push(`${i.length} certificate(s) are expired`);let s=e.filter(c=>c.status==="revoked");s.length>0&&t.push(`${s.length} certificate(s) are revoked`);let a=e.some(c=>c.type==="root"),o=e.some(c=>c.type==="device");return a||t.push("Missing root certificate"),o||t.push("Missing device certificate"),{chainValid:a&&o&&t.length===0,rootTrusted:a,notExpired:i.length===0,revocationChecked:true,issues:t}}static buildPEMConfiguration(e,t){let r=t.find(s=>s.type==="device"),i=new Date;return {pemId:e,deviceSerialNumber:r?.serialNumber||"unknown",certificates:t,configuration:{fiscalMemorySize:"32MB",supportedOperations:["sale","return","void","daily_close"],maxDailyTransactions:1e3,complianceVersion:"2.1.0"},status:this.determinePEMStatus(t),lastAudit:new Date(i.getTime()-720*60*60*1e3).toISOString(),nextCertificateRenewal:this.calculateNextRenewal(t)}}static determinePEMStatus(e){let t=new Date,r=new Date(t.getTime()+720*60*60*1e3);return e.some(o=>new Date(o.validTo)<=t)?"maintenance":e.some(o=>new Date(o.validTo)<=r)?"certificate_renewal":e.some(o=>o.status==="revoked")?"compliance_check":"active"}static calculateNextRenewal(e){if(e.length===0)return new Date().toISOString();let t=e.map(i=>new Date(i.validTo)).sort((i,s)=>i.getTime()-s.getTime())[0];return t?new Date(t.getTime()-1440*60*60*1e3).toISOString():new Date().toISOString()}static assessCompliance(e){let t=[],r=[],i=100,s=e.certificates.filter(u=>new Date(u.validTo)<=new Date);s.length>0&&(i-=30,t.push(`${s.length} expired certificate(s)`),r.push("Renew expired certificates immediately"));let a=e.certificates.filter(u=>{let g=new Date(u.validTo),I=new Date(Date.now()+720*60*60*1e3);return g<=I&&g>new Date});if(a.length>0&&(i-=15,t.push(`${a.length} certificate(s) expiring within 30 days`),r.push("Schedule certificate renewal")),e.lastAudit){let u=new Date(e.lastAudit),g=new Date(Date.now()-4320*60*60*1e3);u<g&&(i-=20,t.push("Audit overdue (last audit more than 6 months ago)"),r.push("Schedule compliance audit"));}else i-=25,t.push("No audit history found"),r.push("Conduct initial compliance audit");let o="full";i<70?o="non_compliant":i<85?o="partial":t.length>0&&(o="under_review");let c=new Date;return {level:o,score:Math.max(0,i),issues:t,recommendations:r,lastCheck:c.toISOString(),nextCheck:new Date(c.getTime()+720*60*60*1e3).toISOString()}}static formatCertificateForDisplay(e){let t=new Date,r=new Date(e.validTo),i=Math.ceil((r.getTime()-t.getTime())/(1e3*60*60*24));return {displayName:`${e.type.toUpperCase()} Certificate`,statusBadge:e.status.toUpperCase(),validity:`${e.validFrom.split("T")[0]} to ${e.validTo.split("T")[0]}`,issuerShort:e.issuer.split(",")[0]||e.issuer,expiresIn:i>0?`${i} days`:"Expired"}}static generateCertificateSummary(e){let t=new Date,r=new Date(t.getTime()+720*60*60*1e3),i={totalCertificates:e.length,validCertificates:0,expiredCertificates:0,expiringSoon:0,revokedCertificates:0,typeBreakdown:{},nextExpiry:null},s=null;for(let a of e){let o=new Date(a.validTo);a.status==="revoked"?i.revokedCertificates++:o<=t?i.expiredCertificates++:o<=r?i.expiringSoon++:i.validCertificates++,i.typeBreakdown[a.type]=(i.typeBreakdown[a.type]||0)+1,(!s||o<s)&&(s=o);}return i.nextExpiry=s&&s.toISOString().split("T")[0]||null,i}static validateCertificateSignature(e,t){if(!t&&e.type!=="root")return {valid:false,error:"Cannot validate signature without issuer certificate"};let r=e.fingerprint&&e.fingerprint!=="unknown";return {valid:!!r,...r?{}:{error:"Invalid certificate signature"}}}static generateRenewalRequest(e){let t=new Date,r=new Date(e.validTo),i=Math.ceil((r.getTime()-t.getTime())/(1e3*60*60*24)),s="low";return i<=0?s="critical":i<=7?s="high":i<=30&&(s="medium"),{certificateId:e.id,currentExpiry:e.validTo,requestedValidityPeriod:365,justification:i<=30?"Certificate expiring soon":"Routine renewal",urgency:s}}};});R();var B=class{constructor(e){this.config=e;this.state="CLOSED";this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,consecutiveFailures:0,consecutiveSuccesses:0,lastFailureTime:null,lastSuccessTime:null,stateChanges:[]};this.nextAttemptTime=0;this.healthCheckTimer=null;e.healthCheckInterval&&this.startHealthCheck();}async execute(e,t="unknown"){if(this.shouldRejectRequest())throw new exports.CircuitBreakerError(`Circuit breaker is ${this.state} for operation: ${t}`,t,this.state);this.metrics.totalRequests++;try{let r=await this.executeWithTimeout(e);return this.onSuccess(),r}catch(r){throw this.onFailure(),r}}async executeWithTimeout(e){let t=new Promise((r,i)=>{setTimeout(()=>{i(new Error(`Operation timeout after ${this.config.timeout}ms`));},this.config.timeout);});return Promise.race([e(),t])}shouldRejectRequest(){switch(this.state){case "CLOSED":return  false;case "OPEN":return Date.now()<this.nextAttemptTime;case "HALF_OPEN":return  false;default:return  false}}onSuccess(){switch(this.metrics.successfulRequests++,this.metrics.consecutiveSuccesses++,this.metrics.consecutiveFailures=0,this.metrics.lastSuccessTime=Date.now(),this.state){case "HALF_OPEN":this.metrics.consecutiveSuccesses>=this.config.successThreshold&&this.transitionTo("CLOSED","Success threshold reached");break;case "OPEN":this.transitionTo("HALF_OPEN","First success after opening");break}}onFailure(){switch(this.metrics.failedRequests++,this.metrics.consecutiveFailures++,this.metrics.consecutiveSuccesses=0,this.metrics.lastFailureTime=Date.now(),this.state){case "CLOSED":this.metrics.consecutiveFailures>=this.config.failureThreshold&&this.transitionTo("OPEN","Failure threshold reached");break;case "HALF_OPEN":this.transitionTo("OPEN","Failed during half-open state");break}}transitionTo(e,t){let r=this.state;this.state=e,this.metrics.stateChanges.push({from:r,to:e,timestamp:Date.now(),reason:t}),this.metrics.stateChanges.length>100&&this.metrics.stateChanges.shift(),e==="OPEN"&&(this.nextAttemptTime=Date.now()+this.config.resetTimeout),console.log(`Circuit breaker ${this.config.name||"unnamed"} transitioned from ${r} to ${e}: ${t}`);}startHealthCheck(){this.config.healthCheckInterval&&(this.healthCheckTimer=setInterval(()=>{this.performHealthCheck();},this.config.healthCheckInterval));}performHealthCheck(){this.state==="OPEN"&&Date.now()>=this.nextAttemptTime&&this.transitionTo("HALF_OPEN","Health check triggered state change");}getState(){return this.state}getMetrics(){return {...this.metrics}}reset(){this.state="CLOSED",this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,consecutiveFailures:0,consecutiveSuccesses:0,lastFailureTime:null,lastSuccessTime:null,stateChanges:[]},this.nextAttemptTime=0;}destroy(){this.healthCheckTimer&&(clearInterval(this.healthCheckTimer),this.healthCheckTimer=null);}getHealthStatus(){let e=Date.now(),t=this.metrics.lastSuccessTime?e-this.metrics.lastSuccessTime:0,r=this.metrics.totalRequests>0?this.metrics.failedRequests/this.metrics.totalRequests:0;return {isHealthy:this.state==="CLOSED"&&r<.5,failureRate:r,uptime:t}}};R();var U=class{constructor(e){this.config=e;this.metrics={totalAttempts:0,successfulRetries:0,failedRetries:0,averageDelay:0,attempts:[]};}async execute(e,t="unknown"){let r=null,i=this.config.baseDelay;for(let s=1;s<=this.config.maxAttempts;s++){this.metrics.totalAttempts++;try{let a=await this.executeWithTimeout(e);return s>1&&this.metrics.successfulRetries++,a}catch(a){r=a;let o={attempt:s,delay:i,error:r,timestamp:Date.now()};if(this.metrics.attempts.push(o),this.metrics.attempts.length>100&&this.metrics.attempts.shift(),s===this.config.maxAttempts||!this.shouldRetry(r)){this.metrics.failedRetries++;break}let c=this.calculateDelay(s,i);console.log(`Retrying ${t} (attempt ${s}/${this.config.maxAttempts}) after ${c}ms delay. Error: ${r.message}`),await this.sleep(c),i=Math.min(i*this.config.backoffMultiplier,this.config.maxDelay);}}throw r||new Error("Unknown error during retry execution")}async executeWithTimeout(e){if(!this.config.timeout)return e();let t=new Promise((r,i)=>{setTimeout(()=>{i(new Error(`Operation timeout after ${this.config.timeout}ms`));},this.config.timeout);});return Promise.race([e(),t])}shouldRetry(e){if(e instanceof exports.ACubeSDKError)return e.retryable;let t=this.extractStatusCode(e);if(t&&this.config.retryableStatusCodes.includes(t))return  true;let r=this.extractErrorCode(e);return !!(r&&this.config.retryableErrors.includes(r)||this.isNetworkError(e))}calculateDelay(e,t){switch(this.config.jitterType){case "none":return t;case "full":return Math.random()*t;case "equal":return t/2+Math.random()*(t/2);case "decorrelated":return Math.random()*(Math.min(this.config.maxDelay,t*3)-this.config.baseDelay)+this.config.baseDelay;default:return t}}extractStatusCode(e){let t=e;return t.statusCode||t.status||t.response?.status||null}extractErrorCode(e){let t=e;return t.code||t.errno||e.name||null}isNetworkError(e){let t=["ECONNRESET","ECONNREFUSED","ETIMEDOUT","ENOTFOUND","ENETUNREACH","EAI_AGAIN","ECONNABORTED"],r=this.extractErrorCode(e);return r?t.includes(r):false}sleep(e){return new Promise(t=>setTimeout(t,e))}getMetrics(){let e=this.metrics.attempts.reduce((t,r)=>t+r.delay,0);return {...this.metrics,averageDelay:this.metrics.attempts.length>0?e/this.metrics.attempts.length:0}}reset(){this.metrics={totalAttempts:0,successfulRetries:0,failedRetries:0,averageDelay:0,attempts:[]};}},ue={maxAttempts:3,baseDelay:1e3,maxDelay:3e4,backoffMultiplier:2,jitterType:"equal",retryableStatusCodes:[500,502,503,504,429],retryableErrors:["ECONNRESET","ECONNREFUSED","ETIMEDOUT","ENOTFOUND","ENETUNREACH","NETWORK_ERROR","RATE_LIMIT_ERROR"],timeout:3e4},ke={maxAttempts:5,baseDelay:500,maxDelay:6e4,backoffMultiplier:2.5,jitterType:"decorrelated",retryableStatusCodes:[500,502,503,504,429,408],retryableErrors:["ECONNRESET","ECONNREFUSED","ETIMEDOUT","ENOTFOUND","ENETUNREACH","NETWORK_ERROR","RATE_LIMIT_ERROR","CIRCUIT_BREAKER_ERROR"],timeout:45e3},Ne={maxAttempts:2,baseDelay:2e3,maxDelay:1e4,backoffMultiplier:1.5,jitterType:"full",retryableStatusCodes:[500,502,503,504],retryableErrors:["NETWORK_ERROR"],timeout:15e3};var L=class{constructor(){this.middlewares=[];}add(e){return this.middlewares.push(e),this.middlewares.sort((t,r)=>r.priority-t.priority),this}remove(e){return this.middlewares=this.middlewares.filter(t=>t.name!==e),this}async executeBeforeRequest(e){let t=e;for(let r of this.middlewares)if(r.beforeRequest)try{t=await r.beforeRequest(t);}catch(i){console.warn(`Middleware ${r.name} failed in beforeRequest:`,i);}return t}async executeAfterResponse(e,t){let r=t;for(let i of [...this.middlewares].reverse())if(i.afterResponse)try{r=await i.afterResponse(e,r);}catch(s){console.warn(`Middleware ${i.name} failed in afterResponse:`,s);}return r}async executeOnError(e,t){let r=t;for(let i of this.middlewares)if(i.onError)try{let s=await i.onError(e,r);s instanceof Error&&(r=s);}catch(s){console.warn(`Middleware ${i.name} failed in onError:`,s);}return r}getMiddlewares(){return [...this.middlewares]}clear(){return this.middlewares=[],this}},H=class{constructor(e){this.getToken=e;this.name="authentication";this.priority=100;}async beforeRequest(e){let t=await this.getToken();return t&&(e.headers.Authorization=`Bearer ${t}`),e}},j=class{constructor(){this.name="request-id";this.priority=90;}beforeRequest(e){return e.headers["X-Request-ID"]||(e.headers["X-Request-ID"]=e.requestId),e}},$=class{constructor(e){this.userAgent=e;this.name="user-agent";this.priority=80;}beforeRequest(e){return e.headers["User-Agent"]||(e.headers["User-Agent"]=this.userAgent),e}},G=class{constructor(){this.name="content-type";this.priority=70;}beforeRequest(e){return e.body&&!e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/json"),e}},z=class{constructor(e,t={logRequests:true,logResponses:true,logHeaders:false,logBody:false,sanitizeHeaders:["authorization","cookie","x-api-key"]}){this.logger=e;this.options=t;this.name="logging";this.priority=10;}beforeRequest(e){if(this.options.logRequests){let t={requestId:e.requestId,method:e.method,url:e.url};this.options.logHeaders&&(t.headers=this.sanitizeHeaders(e.headers)),this.options.logBody&&e.body&&(t.body=this.sanitizeBody(e.body)),this.logger.debug("HTTP Request",t);}return e}afterResponse(e,t){if(this.options.logResponses){let r={requestId:e.requestId,status:t.status,statusText:t.statusText,duration:t.duration};this.options.logHeaders&&(r.headers=this.sanitizeHeaders(t.headers)),this.options.logBody&&t.data&&(r.body=this.sanitizeBody(t.data));let i=t.status>=400?"error":"debug";this.logger[i]("HTTP Response",r);}return t}onError(e,t){return this.logger.error("HTTP Error",{requestId:e.requestId,method:e.method,url:e.url,error:t.message,stack:t.stack}),t}sanitizeHeaders(e){let t={...e};return this.options.sanitizeHeaders?.forEach(r=>{let i=Object.keys(t).find(s=>s.toLowerCase()===r.toLowerCase());i&&(t[i]="[REDACTED]");}),t}sanitizeBody(e){if(typeof e!="object"||e===null)return e;let t=["password","token","secret","key","auth"],r={...e};return Object.keys(r).forEach(i=>{t.some(s=>i.toLowerCase().includes(s))&&(r[i]="[REDACTED]");}),r}},de=class{constructor(e){this.config=e;this.name="rate-limiting";this.priority=50;this.requests=new Map;}async beforeRequest(e){let t=this.config.keyGenerator?.(e)||"default",r=Date.now(),i=r-6e4,a=(this.requests.get(t)||[]).filter(o=>o>i);if(a.length>=this.config.requestsPerMinute)throw new Error(`Rate limit exceeded: ${this.config.requestsPerMinute} requests per minute`);return a.push(r),this.requests.set(t,a),e}},pe=class{constructor(){this.name="performance";this.priority=5;this.metrics=new Map;}afterResponse(e,t){let r=`${e.method} ${e.url}`,i=t.duration,s=this.metrics.get(r)||{count:0,totalDuration:0,minDuration:1/0,maxDuration:0};return this.metrics.set(r,{count:s.count+1,totalDuration:s.totalDuration+i,minDuration:Math.min(s.minDuration,i),maxDuration:Math.max(s.maxDuration,i)}),t}getMetrics(){let e={};return this.metrics.forEach((t,r)=>{e[r]={count:t.count,averageDuration:t.totalDuration/t.count,minDuration:t.minDuration===1/0?0:t.minDuration,maxDuration:t.maxDuration};}),e}reset(){this.metrics.clear();}};R();var K=class extends eventemitter3.EventEmitter{constructor(t){super();this.config=t;this.requestCounter=0;this.middlewareStack=new L,this.circuitBreaker=new B(t.circuitBreakerConfig),this.retryHandler=new U(t.retryConfig),this.setupDefaultMiddlewares();}setupDefaultMiddlewares(){this.config.getAuthToken&&this.middlewareStack.add(new H(this.config.getAuthToken)),this.middlewareStack.add(new j),this.middlewareStack.add(new $(this.config.userAgent)),this.middlewareStack.add(new G),this.config.enableLogging&&this.middlewareStack.add(new z({debug:(t,r)=>this.emit("debug",t,r),warn:(t,r)=>this.emit("warn",t,r),error:(t,r)=>this.emit("error",t,r)},{logRequests:true,logResponses:true,logHeaders:false,logBody:false}));}async request(t){let r=this.generateRequestId(),i=Date.now(),s={url:this.buildUrl(t.url,t.params),method:t.method,headers:{...this.config.headers,...t.headers},body:t.data,metadata:t.metadata||{},startTime:i,requestId:r},a=async()=>{try{let o=await this.middlewareStack.executeBeforeRequest(s),c=await this.makeHttpRequest(o,t.timeout),u=await this.middlewareStack.executeAfterResponse(o,c);return {data:u.data,status:u.status,statusText:u.statusText,headers:u.headers,requestId:r,duration:u.duration}}catch(o){throw await this.middlewareStack.executeOnError(s,o)}};try{return this.config.enableCircuitBreaker&&!t.skipCircuitBreaker?this.config.enableRetry&&!t.skipRetry?await this.circuitBreaker.execute(()=>this.retryHandler.execute(()=>a(),`${t.method} ${t.url}`),`${t.method} ${t.url}`):await this.circuitBreaker.execute(a,`${t.method} ${t.url}`):this.config.enableRetry&&!t.skipRetry?await this.retryHandler.execute(a,`${t.method} ${t.url}`):await a()}catch(o){throw this.emit("requestError",{requestId:r,method:t.method,url:t.url,error:o instanceof Error?o.message:"Unknown error",duration:Date.now()-i}),o}}async makeHttpRequest(t,r){let i=r||this.config.timeout,s=new AbortController,a=setTimeout(()=>s.abort(),i);try{let o={method:t.method,headers:t.headers,signal:s.signal};t.body&&t.method!=="GET"&&(o.body=typeof t.body=="string"?t.body:JSON.stringify(t.body));let c=await fetch(t.url,o);clearTimeout(a);let u=Date.now(),g=u-t.startTime,I,D=c.headers.get("content-type")||"";D.includes("application/json")?I=await c.json():D.includes("application/pdf")?I=await c.blob():D.includes("text/")?I=await c.text():I=await c.arrayBuffer();let P={};c.headers.forEach((re,M)=>{P[M]=re;});let x={status:c.status,statusText:c.statusText,headers:P,data:I,metadata:{},endTime:u,duration:g};if(!c.ok)throw F({status:c.status,statusText:c.statusText,data:I},`${t.method} ${t.url}`,t.requestId);return this.emit("requestSuccess",{requestId:t.requestId,method:t.method,url:t.url,status:c.status,duration:g}),x}catch(o){throw clearTimeout(a),o instanceof exports.ACubeSDKError?o:o instanceof Error?o.name==="AbortError"?F({status:408,statusText:"Request Timeout",data:{message:"Request timeout"}},`${t.method} ${t.url}`,t.requestId):F({status:0,statusText:"Network Error",data:{message:o.message}},`${t.method} ${t.url}`,t.requestId):o}}buildUrl(t,r){let i=new URL(t,this.config.baseUrl);return r&&Object.entries(r).forEach(([s,a])=>{a!=null&&i.searchParams.append(s,String(a));}),i.toString()}generateRequestId(){return `req_${Date.now()}_${++this.requestCounter}_${Math.random().toString(36).substring(2,8)}`}async get(t,r={}){return this.request({...r,method:"GET",url:t})}async post(t,r,i={}){return this.request({...i,method:"POST",url:t,data:r})}async put(t,r,i={}){return this.request({...i,method:"PUT",url:t,data:r})}async delete(t,r={}){return this.request({...r,method:"DELETE",url:t})}async patch(t,r,i={}){return this.request({...i,method:"PATCH",url:t,data:r})}addMiddleware(t){return this.middlewareStack.add(t),this}removeMiddleware(t){return this.middlewareStack.remove(t),this}getCircuitBreakerMetrics(){return this.circuitBreaker.getMetrics()}getRetryMetrics(){return this.retryHandler.getMetrics()}getHealthStatus(){return {circuitBreaker:this.circuitBreaker.getHealthStatus(),retry:this.retryHandler.getMetrics()}}updateConfig(t){Object.assign(this.config,t);}destroy(){this.circuitBreaker.destroy(),this.retryHandler.reset(),this.middlewareStack.clear(),this.removeAllListeners();}},W={baseUrl:"https://ereceipts-it-sandbox.acubeapi.com",timeout:3e4,retryConfig:ue,circuitBreakerConfig:{failureThreshold:5,successThreshold:2,timeout:3e4,resetTimeout:6e4,name:"acube-http-client"},headers:{Accept:"application/json","Content-Type":"application/json"},enableCircuitBreaker:true,enableRetry:true,enableLogging:true,userAgent:"ACube-SDK/2.0.0"},le={...W,baseUrl:"https://common-sandbox.api.acubeapi.com",circuitBreakerConfig:{...W.circuitBreakerConfig,name:"acube-auth-client"}};var A={environment:"sandbox",apiKey:"",baseUrls:{},httpConfig:{},auth:{autoRefresh:true},logging:{enabled:true,level:"warn",sanitize:true},features:{enableRetry:true,enableCircuitBreaker:true,enableMetrics:true,enableOfflineQueue:false},dev:{enableMocking:false,mockDelay:0}},S=class extends eventemitter3.EventEmitter{constructor(t){super();this.isInitialized=false;this.config=this.mergeConfig(t),this.apiClient=this.createHttpClient("api"),this.authClient=this.createHttpClient("auth"),this.setupEventHandlers();}mergeConfig(t){return {...A,...t,baseUrls:{...A.baseUrls,...t.baseUrls},httpConfig:{...A.httpConfig,...t.httpConfig},auth:{...A.auth,...t.auth},logging:{...A.logging,...t.logging},features:{...A.features,...t.features},dev:{...A.dev,...t.dev}}}createHttpClient(t){let r=t==="api"?W:le,i;t==="api"?i=this.config.baseUrls.api||this.getDefaultApiUrl():i=this.config.baseUrls.auth||this.getDefaultAuthUrl();let s={...r,...this.config.httpConfig,baseUrl:i,enableRetry:this.config.features.enableRetry??true,enableCircuitBreaker:this.config.features.enableCircuitBreaker??true,enableLogging:this.config.logging.enabled,...this.config.auth.getToken&&{getAuthToken:this.config.auth.getToken},userAgent:`ACube-SDK/2.0.0 (${this.config.environment})`};return new K(s)}getDefaultApiUrl(){switch(this.config.environment){case "production":return "https://ereceipts-it.acubeapi.com";case "development":return "https://ereceipts-it.dev.acubeapi.com";case "sandbox":default:return "https://ereceipts-it-sandbox.acubeapi.com"}}getDefaultAuthUrl(){switch(this.config.environment){case "production":return "https://common.api.acubeapi.com";case "development":case "sandbox":default:return "https://common-sandbox.api.acubeapi.com"}}setupEventHandlers(){this.apiClient.on("requestError",t=>{this.emit("error",{type:"error",timestamp:new Date,requestId:t.requestId,data:{errorCode:"HTTP_REQUEST_FAILED",errorMessage:t.error,operation:`${t.method} ${t.url}`,retry:false,context:{client:"api",...t}}});}),this.authClient.on("requestError",t=>{this.emit("error",{type:"error",timestamp:new Date,requestId:t.requestId,data:{errorCode:"AUTH_REQUEST_FAILED",errorMessage:t.error,operation:`${t.method} ${t.url}`,retry:false,context:{client:"auth",...t}}});}),this.config.auth.onTokenExpired&&this.on("auth.expired",this.config.auth.onTokenExpired);}async initialize(){if(!this.isInitialized)try{this.validateConfig(),this.config.features.enableMetrics&&await this.performHealthCheck(),this.isInitialized=!0,this.emit("error",{type:"error",timestamp:new Date,requestId:`init_success_${Date.now()}`,data:{errorCode:"SDK_INITIALIZED",errorMessage:"SDK initialized successfully",operation:"initialize",retry:!1,context:{environment:this.config.environment,features:this.config.features}}});}catch(t){throw this.emit("error",{type:"error",timestamp:new Date,requestId:`init_${Date.now()}`,data:{errorCode:"SDK_INITIALIZATION_FAILED",errorMessage:t instanceof Error?t.message:"Unknown error",operation:"initialize",retry:false}}),t}}validateConfig(){if(!["sandbox","production","development"].includes(this.config.environment))throw new Error(`Invalid environment: ${this.config.environment}`);if(this.config.auth.getToken&&typeof this.config.auth.getToken!="function")throw new Error("auth.getToken must be a function")}async performHealthCheck(){try{let t=this.apiClient.getHealthStatus();this.emit("error",{type:"error",timestamp:new Date,requestId:`health_${Date.now()}`,data:{errorCode:"HEALTH_CHECK_COMPLETED",errorMessage:"Health check completed",operation:"health-check",retry:!1,context:{healthStatus:t}}});}catch(t){this.emit("error",{type:"error",timestamp:new Date,requestId:`health_failed_${Date.now()}`,data:{errorCode:"HEALTH_CHECK_FAILED",errorMessage:"Health check failed",operation:"health-check",retry:false,context:{error:t}}});}}get cashiers(){if(!this._cashiers){let{CashiersResource:t}=(me(),w(ye));this._cashiers=new t(this.apiClient);}return this._cashiers}get receipts(){if(!this._receipts){let{ReceiptsResource:t}=(he(),w(Ie));this._receipts=new t(this.apiClient);}return this._receipts}get pointOfSales(){if(!this._pointOfSales){let{PointOfSalesResource:t}=(fe(),w(Ce));this._pointOfSales=new t(this.apiClient);}return this._pointOfSales}get cashRegisters(){if(!this._cashRegisters){let{CashRegistersResource:t}=(ge(),w(Te));this._cashRegisters=new t(this.apiClient);}return this._cashRegisters}get merchants(){if(!this._merchants){let{MerchantsResource:t}=(_e(),w(Ee));this._merchants=new t(this.apiClient);}return this._merchants}get pems(){if(!this._pems){let{PEMsResource:t}=(Re(),w(be));this._pems=new t(this.apiClient);}return this._pems}updateConfig(t){let r=this.mergeConfig({...this.config,...t});(t.httpConfig||t.baseUrls||t.environment)&&(this.apiClient.updateConfig(this.createHttpClient("api").config),this.authClient.updateConfig(this.createHttpClient("auth").config)),this.config=r,this.emit("error",{type:"error",timestamp:new Date,requestId:`config_${Date.now()}`,data:{errorCode:"CONFIG_UPDATED",errorMessage:"Configuration updated",operation:"update-config",retry:false,context:{updates:t}}});}getConfig(){return {...this.config}}getMetrics(){return {api:this.apiClient.getHealthStatus(),auth:this.authClient.getHealthStatus(),isInitialized:this.isInitialized,environment:this.config.environment}}getClients(){return {api:this.apiClient,auth:this.authClient}}destroy(){this.apiClient.destroy(),this.authClient.destroy(),this.removeAllListeners(),this.isInitialized=false,this.emit("error",{type:"error",timestamp:new Date,requestId:`destroy_${Date.now()}`,data:{errorCode:"SDK_DESTROYED",errorMessage:"SDK destroyed",operation:"destroy",retry:false}});}};function te(n){return new S(n)}E();me();he();ge();_e();Re();fe();b();var Et=n=>n,bt=n=>n,At=n=>n,Pt=n=>n,vt=n=>n,wt=n=>n,Ot=n=>n,St=n=>n,Dt=n=>n,xt=n=>n,Mt=n=>n,qt=n=>typeof n=="string"&&n.length>0,kt=n=>typeof n=="number"&&n>0,Nt=n=>typeof n=="string"&&/^\d{11}$/.test(n),Vt=n=>typeof n=="string"&&/^\d+\.\d{2,8}$/.test(n);R();function Ut(n={}){return te({environment:"sandbox",...n})}function Lt(n={}){return te({environment:"production",...n})}function Ht(n={}){return te({environment:"development",...n})}var jt="2.0.0",$t="1.0.0",Gt=S;
exports.ACubeSDK=S;exports.AGGRESSIVE_RETRY_CONFIG=ke;exports.API_VERSION=$t;exports.AUTH_HTTP_CONFIG=le;exports.AuthenticationMiddleware=H;exports.CONSERVATIVE_RETRY_CONFIG=Ne;exports.CashRegisters=exports.CashRegistersResource;exports.Cashiers=exports.CashiersResource;exports.CircuitBreaker=B;exports.ContentTypeMiddleware=G;exports.DEFAULT_HTTP_CONFIG=W;exports.DEFAULT_RETRY_CONFIG=ue;exports.DEFAULT_SDK_CONFIG=A;exports.HttpClient=K;exports.LoggingMiddleware=z;exports.Merchants=exports.MerchantsResource;exports.MiddlewareStack=L;exports.PEMs=exports.PEMsResource;exports.PerformanceMiddleware=pe;exports.PointOfSales=exports.PointOfSalesResource;exports.RateLimitingMiddleware=de;exports.Receipts=exports.ReceiptsResource;exports.RequestIdMiddleware=j;exports.RetryHandler=U;exports.SDK_VERSION=jt;exports.UserAgentMiddleware=$;exports.createACubeSDK=te;exports.createAmount=Dt;exports.createCashRegisterId=vt;exports.createCashierId=bt;exports.createDocumentNumber=St;exports.createErrorFromResponse=F;exports.createFiscalId=Ot;exports.createMerchantId=Pt;exports.createPEMId=At;exports.createQuantity=Mt;exports.createReceiptId=Et;exports.createSerialNumber=wt;exports.createVATRate=xt;exports.default=Gt;exports.initializeDevelopmentSDK=Ht;exports.initializeProductionSDK=Lt;exports.initializeSandboxSDK=Ut;exports.isAmount=Vt;exports.isCashierId=kt;exports.isFiscalId=Nt;exports.isReceiptId=qt;//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map